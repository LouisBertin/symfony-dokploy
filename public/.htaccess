# Use the front controller as index file
DirectoryIndex index.php

<IfModule mod_negotiation.c>
    Options -MultiViews
</IfModule>

<IfModule mod_rewrite.c>
    RewriteEngine On

    # Redirect to URI without front controller to prevent duplicate content
    RewriteCond %{REQUEST_URI}::$0 ^(/.+)/index\.php(:.*)?$ [NC]
    RewriteRule ^(.*?)/index\.php(?:/(.*))?$ $1/$2 [R=301,L]

    # If the requested filename exists, simply serve it
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^ - [L]

    # Rewrite all other queries to the front controller
    RewriteRule ^(.*)$ index.php [QSA,L]
</IfModule>